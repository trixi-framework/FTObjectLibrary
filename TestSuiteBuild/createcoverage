#!/bin/bash

# Fail fast and verbosely
set -eox pipefail

# Clean up
make -f TestSuite.mak clean

# Build test suite
make -f TestSuite.mak -j 2 F90=$F90 FFLAGS="-cpp --coverage -O0" LDFLAGS="--coverage"

# Reset counters
lcov --directory . --zerocounters

# Run tests
./runSuite

# Process coverage
lcov --directory . --capture --output-file lcov.info
